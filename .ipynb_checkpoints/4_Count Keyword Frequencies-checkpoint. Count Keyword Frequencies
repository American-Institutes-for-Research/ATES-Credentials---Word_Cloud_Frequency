{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "4e57621e",
   "metadata": {},
   "source": [
    "# Read in and Clean Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "6ac406e7",
   "metadata": {},
   "outputs": [],
   "source": [
    "# import packages\n",
    "import os\n",
    "import pandas as pd\n",
    "import nltk\n",
    "from nltk import WhitespaceTokenizer\n",
    "from nltk.corpus import stopwords\n",
    "from string import punctuation as original_punct\n",
    "import re\n",
    "from collections import Counter\n",
    "import string\n",
    "from nltk.stem import WordNetLemmatizer \n",
    "\n",
    "# read in data\n",
    "df = pd.read_csv(\"Data_IRS_ExcludeMuseumOnly.csv\")\n",
    "\n",
    "# read in list of keywords\n",
    "keyword_df = pd.read_csv(\"Keyword_Final_Draft_121521.csv\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "13b51c71",
   "metadata": {},
   "source": [
    "### Clean names"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7c2f7c73",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[nltk_data] Downloading package stopwords to\n",
      "[nltk_data]     C:\\Users\\ydeng\\AppData\\Roaming\\nltk_data...\n",
      "[nltk_data]   Package stopwords is already up-to-date!\n",
      "[nltk_data] Downloading package wordnet to\n",
      "[nltk_data]     C:\\Users\\ydeng\\AppData\\Roaming\\nltk_data...\n",
      "[nltk_data]   Package wordnet is already up-to-date!\n"
     ]
    }
   ],
   "source": [
    "# get name column and make lowercase\n",
    "names = df[\"name\"]\n",
    "names = [str(name).lower() for name in names]\n",
    "\n",
    "# remove word equivalents\n",
    "names2 = []\n",
    "for name in names:\n",
    "    name = re.sub(r\"\\bctr\\b\", \"center\", name)\n",
    "    name = re.sub(r\"\\bcntr\\b\", \"center\", name)\n",
    "    name = re.sub(r\"\\bassn\\b\", \"association\", name)\n",
    "    name = re.sub(r\"\\bassoc\\b\", \" association\", name)\n",
    "    names2.append(name)\n",
    "    \n",
    "# create stop word list\n",
    "nltk.download('stopwords')\n",
    "stop_words = stopwords.words('english') + list(original_punct)\n",
    "\n",
    "# define lemmatizer\n",
    "nltk.download('wordnet')\n",
    "lemmatizer = WordNetLemmatizer() \n",
    "\n",
    "name_tokens = []\n",
    "for name in names2:\n",
    "    name = WhitespaceTokenizer().tokenize(name)           # tokenize\n",
    "    name = filter(lambda x: x.isalpha(), name)            # remove numerics\n",
    "    name = [lemmatizer.lemmatize(w) for w in name]        # lemmatize\n",
    "    name = [w for w in name if not w in stop_words]       # remove stop words \n",
    "    name_tokens.append(name)\n",
    "    \n",
    "# string tweets together again\n",
    "names = [\" \".join(name) for name in name_tokens] \n",
    "\n",
    "df[\"name\"] = names"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "53862f24",
   "metadata": {},
   "source": [
    "### Clean keywords"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "f1b56aea",
   "metadata": {},
   "outputs": [],
   "source": [
    "keyword_df = pd.read_csv(\"Keyword_Final_Draft_121521.csv\")\n",
    "\n",
    "# make keywords lowercase\n",
    "keywords = keyword_df[\"Keyword\"]\n",
    "keywords = [str(keyword).lower() for keyword in keywords]\n",
    "\n",
    "\n",
    "# lemmatize keywords\n",
    "keyword_tokens = []\n",
    "for keyword in keywords:\n",
    "    keyword = WhitespaceTokenizer().tokenize(keyword)           # tokenize\n",
    "    keyword = [lemmatizer.lemmatize(w) for w in keyword]        # lemmatize\n",
    "    keyword = [w for w in keyword if not w in stop_words]       # remove stop words \n",
    "    keyword_tokens.append(keyword)\n",
    "    \n",
    "# string keywords together again and put back in keyword_df\n",
    "keywords = [\" \".join(keyword) for keyword in keyword_tokens]\n",
    "keyword_df[\"Keyword\"] = keywords\n",
    "\n",
    "keyword_df.drop_duplicates(\"Keyword\")\n",
    "keywords = list(set(keywords))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "44affdf9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['memorial',\n",
       " 'botanic',\n",
       " 'museo',\n",
       " 'battlefield',\n",
       " 'safari',\n",
       " 'nature preserve',\n",
       " 'arboretum',\n",
       " 'gallery',\n",
       " 'volary',\n",
       " 'marine exhibit',\n",
       " '#name?',\n",
       " 'archaeology',\n",
       " 'cavern',\n",
       " 'theater',\n",
       " 'science center',\n",
       " 'nature center',\n",
       " 'lighthouse',\n",
       " 'antique',\n",
       " 'artillery',\n",
       " 'salon',\n",
       " 'aboetum',\n",
       " 'scenic',\n",
       " 'antiquity',\n",
       " 'culture',\n",
       " 'historical',\n",
       " 'vintage',\n",
       " 'cultural',\n",
       " 'sculpture garden',\n",
       " 'repository',\n",
       " 'butterfly house',\n",
       " 'atheneum',\n",
       " 'botanical',\n",
       " 'consortium',\n",
       " 'conservancy',\n",
       " 'game refuge',\n",
       " 'sanctuary',\n",
       " 'apparatus',\n",
       " 'treasury',\n",
       " 'legacy',\n",
       " 'multicultural',\n",
       " 'aquarium',\n",
       " 'exhibit',\n",
       " 'pioneer village',\n",
       " 'artisan',\n",
       " 'marine center',\n",
       " 'model',\n",
       " 'meritime',\n",
       " 'terrarium',\n",
       " 'classic',\n",
       " 'technology center',\n",
       " 'vivarium',\n",
       " 'wildlife',\n",
       " 'preservation',\n",
       " 'warbird',\n",
       " 'historic',\n",
       " 'library',\n",
       " 'birdhouse',\n",
       " 'archaeological',\n",
       " 'discovery',\n",
       " 'nature park',\n",
       " 'display',\n",
       " 'hall fame',\n",
       " 'archive',\n",
       " 'conservation',\n",
       " 'art',\n",
       " 'collector',\n",
       " 'assemblage',\n",
       " 'vault',\n",
       " 'genealogical',\n",
       " 'historial',\n",
       " 'museum',\n",
       " 'nursery',\n",
       " 'herbarium',\n",
       " 'artifact',\n",
       " 'observatory',\n",
       " 'studio',\n",
       " 'war',\n",
       " 'reserve',\n",
       " 'ancient',\n",
       " 'battleship',\n",
       " 'dinosaur',\n",
       " 'horticultural',\n",
       " 'warrior',\n",
       " 'memorabilia',\n",
       " 'heritage',\n",
       " 'history',\n",
       " 'wild animal park',\n",
       " 'collectible',\n",
       " 'menagerie',\n",
       " 'theatre',\n",
       " 'nature reserve',\n",
       " 'wwii',\n",
       " 'exhibition',\n",
       " 'fossil',\n",
       " 'game park',\n",
       " 'musuem',\n",
       " 'national park',\n",
       " 'curatorial',\n",
       " 'animal park',\n",
       " 'philatelic',\n",
       " 'conservatory',\n",
       " 'collection',\n",
       " 'adventure childrens',\n",
       " 'zoo',\n",
       " 'hall honor',\n",
       " 'paleontology',\n",
       " 'aviary',\n",
       " 'botanical garden',\n",
       " 'zoological',\n",
       " 'maritime',\n",
       " 'center science',\n",
       " 'planetarium',\n",
       " 'learning center']"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "keywords"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eff8915d",
   "metadata": {},
   "source": [
    "# Output 1: Create Abbreviated Dataframe"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "0e809839",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "<ipython-input-5-fe409f9d33ac>:7: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  chunk[\"keyword\"] = keyword\n",
      "<ipython-input-5-fe409f9d33ac>:12: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  chunk[\"keyword\"] = \"seum\"\n",
      "<ipython-input-5-fe409f9d33ac>:18: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df_not_na[\"keyword\"] = \"\"\n"
     ]
    }
   ],
   "source": [
    "# build new abbreviated dataframe with only rows where there is ntee_cd not NA or a keyword match\n",
    "\n",
    "# df with keyword matches from keyword list\n",
    "df_keyword = pd.DataFrame()\n",
    "for keyword in keyword_df[\"Keyword\"]:\n",
    "    chunk = df[df['name'].str.contains(keyword)]\n",
    "    chunk[\"keyword\"] = keyword\n",
    "    df_keyword = pd.concat([df_keyword, chunk], ignore_index=True)  # add rows that contain this keyword\n",
    "\n",
    "# add \"-seum\" matches to df_keyword_1\n",
    "chunk = df[df['name'].str.contains(\"seum\")]  # any containing \"museum\" will be removed during drop_duplicates later on\n",
    "chunk[\"keyword\"] = \"seum\"\n",
    "df_keyword = pd.concat([df_keyword, chunk], ignore_index=True)   \n",
    "df_keyword = df_keyword.drop_duplicates()\n",
    "\n",
    "# df with non-missing ntee_cd\n",
    "df_not_na = df[df[\"ntee_cd\"].notna()]\n",
    "df_not_na[\"keyword\"] = \"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "af8f00d7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>ein</th>\n",
       "      <th>name</th>\n",
       "      <th>ico</th>\n",
       "      <th>street</th>\n",
       "      <th>city</th>\n",
       "      <th>state</th>\n",
       "      <th>zip</th>\n",
       "      <th>group</th>\n",
       "      <th>subsection</th>\n",
       "      <th>affiliation</th>\n",
       "      <th>...</th>\n",
       "      <th>sort_name</th>\n",
       "      <th>region</th>\n",
       "      <th>Description</th>\n",
       "      <th>Museum</th>\n",
       "      <th>NonMuseum</th>\n",
       "      <th>Possibly_Museum</th>\n",
       "      <th>no_ntee</th>\n",
       "      <th>unknown_ntee</th>\n",
       "      <th>general_ntee_only</th>\n",
       "      <th>keyword</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>611638654</td>\n",
       "      <td>animal park care rescue inc</td>\n",
       "      <td>% ROBERT L CANDY</td>\n",
       "      <td>10105 COTTAGE INN LN NE</td>\n",
       "      <td>CUMBERLAND</td>\n",
       "      <td>MD</td>\n",
       "      <td>21502-8250</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>Animal Protection &amp; Welfare</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>animal park</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>860549101</td>\n",
       "      <td>prescott animal park association</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1403 HERITAGE PARK RD</td>\n",
       "      <td>PRESCOTT</td>\n",
       "      <td>AZ</td>\n",
       "      <td>86301-6001</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>PAPA</td>\n",
       "      <td>3</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>animal park</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>311633140</td>\n",
       "      <td>hollywild animal park inc</td>\n",
       "      <td>% DAVID R MEEKS</td>\n",
       "      <td>2325 HAMPTON RD</td>\n",
       "      <td>WELLFORD</td>\n",
       "      <td>SC</td>\n",
       "      <td>29385-9010</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>animal park</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>844082111</td>\n",
       "      <td>boulder ridge wild animal park foundation</td>\n",
       "      <td>% DAVID HOEKSTRA</td>\n",
       "      <td>8313 PRATT LAKE AVE SE</td>\n",
       "      <td>ALTO</td>\n",
       "      <td>MI</td>\n",
       "      <td>49302-9610</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>Education N.E.C.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>animal park</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>200198427</td>\n",
       "      <td>mead botanical garden inc</td>\n",
       "      <td>% TREASURER</td>\n",
       "      <td>PO BOX 1227</td>\n",
       "      <td>WINTER PARK</td>\n",
       "      <td>FL</td>\n",
       "      <td>32790-1227</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>Parks &amp; Playgrounds</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>botanical garden</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1338149</th>\n",
       "      <td>450459139</td>\n",
       "      <td>red river radio amateur inc</td>\n",
       "      <td>% LORIANN KRUFT -TREASURE</td>\n",
       "      <td>PO BOX 3215</td>\n",
       "      <td>FARGO</td>\n",
       "      <td>ND</td>\n",
       "      <td>58108-3215</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>Radio</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1338150</th>\n",
       "      <td>463779164</td>\n",
       "      <td>cadena radial mision vision corp</td>\n",
       "      <td>NaN</td>\n",
       "      <td>47250 WASHINGTON ST STE A</td>\n",
       "      <td>LA QUINTA</td>\n",
       "      <td>CA</td>\n",
       "      <td>92253-2105</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>Radio</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1338151</th>\n",
       "      <td>834485399</td>\n",
       "      <td>kisa public radio</td>\n",
       "      <td>% LISA TINSLEY</td>\n",
       "      <td>3379 REGENT PL SW</td>\n",
       "      <td>ATLANTA</td>\n",
       "      <td>GA</td>\n",
       "      <td>30311-3092</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>Radio</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1338152</th>\n",
       "      <td>473452717</td>\n",
       "      <td>inc</td>\n",
       "      <td>% RICHARD J VENEZIA</td>\n",
       "      <td>1494 SW BALMORAL TRAC</td>\n",
       "      <td>STUART</td>\n",
       "      <td>FL</td>\n",
       "      <td>34997-0000</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>Radio</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1338153</th>\n",
       "      <td>461932159</td>\n",
       "      <td>wadsworth communication inc</td>\n",
       "      <td>% WADSWORTH COMMUNICATIONS INC</td>\n",
       "      <td>102 MAIN ST</td>\n",
       "      <td>WADSWORTH</td>\n",
       "      <td>OH</td>\n",
       "      <td>44281-1432</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>Radio</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1191246 rows Ã— 37 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "               ein                                       name  \\\n",
       "0        611638654                animal park care rescue inc   \n",
       "1        860549101           prescott animal park association   \n",
       "2        311633140                  hollywild animal park inc   \n",
       "3        844082111  boulder ridge wild animal park foundation   \n",
       "4        200198427                  mead botanical garden inc   \n",
       "...            ...                                        ...   \n",
       "1338149  450459139                red river radio amateur inc   \n",
       "1338150  463779164           cadena radial mision vision corp   \n",
       "1338151  834485399                          kisa public radio   \n",
       "1338152  473452717                                        inc   \n",
       "1338153  461932159                wadsworth communication inc   \n",
       "\n",
       "                                    ico                     street  \\\n",
       "0                      % ROBERT L CANDY    10105 COTTAGE INN LN NE   \n",
       "1                                   NaN      1403 HERITAGE PARK RD   \n",
       "2                       % DAVID R MEEKS            2325 HAMPTON RD   \n",
       "3                      % DAVID HOEKSTRA     8313 PRATT LAKE AVE SE   \n",
       "4                           % TREASURER                PO BOX 1227   \n",
       "...                                 ...                        ...   \n",
       "1338149       % LORIANN KRUFT -TREASURE                PO BOX 3215   \n",
       "1338150                             NaN  47250 WASHINGTON ST STE A   \n",
       "1338151                  % LISA TINSLEY          3379 REGENT PL SW   \n",
       "1338152             % RICHARD J VENEZIA      1494 SW BALMORAL TRAC   \n",
       "1338153  % WADSWORTH COMMUNICATIONS INC                102 MAIN ST   \n",
       "\n",
       "                city state         zip  group  subsection  affiliation  ...  \\\n",
       "0         CUMBERLAND    MD  21502-8250      0           3            3  ...   \n",
       "1           PRESCOTT    AZ  86301-6001      0           3            3  ...   \n",
       "2           WELLFORD    SC  29385-9010      0           3            3  ...   \n",
       "3               ALTO    MI  49302-9610      0           3            3  ...   \n",
       "4        WINTER PARK    FL  32790-1227      0           3            3  ...   \n",
       "...              ...   ...         ...    ...         ...          ...  ...   \n",
       "1338149        FARGO    ND  58108-3215      0           3            3  ...   \n",
       "1338150    LA QUINTA    CA  92253-2105      0           3            3  ...   \n",
       "1338151      ATLANTA    GA  30311-3092      0           3            3  ...   \n",
       "1338152       STUART    FL  34997-0000      0           3            3  ...   \n",
       "1338153    WADSWORTH    OH  44281-1432      0           3            3  ...   \n",
       "\n",
       "         sort_name  region                  Description  Museum  NonMuseum  \\\n",
       "0              NaN       2  Animal Protection & Welfare       0          1   \n",
       "1             PAPA       3                          NaN       0          0   \n",
       "2              NaN       2                          NaN       0          0   \n",
       "3              NaN       2             Education N.E.C.       0          0   \n",
       "4              NaN       3          Parks & Playgrounds       0          0   \n",
       "...            ...     ...                          ...     ...        ...   \n",
       "1338149        NaN       2                        Radio       0          1   \n",
       "1338150        NaN       3                        Radio       0          1   \n",
       "1338151        NaN       3                        Radio       0          1   \n",
       "1338152        NaN       3                        Radio       0          1   \n",
       "1338153        NaN       2                        Radio       0          1   \n",
       "\n",
       "         Possibly_Museum  no_ntee  unknown_ntee  general_ntee_only  \\\n",
       "0                      0        0             0                  0   \n",
       "1                      0        0             1                  0   \n",
       "2                      0        0             1                  0   \n",
       "3                      1        0             0                  0   \n",
       "4                      1        0             0                  0   \n",
       "...                  ...      ...           ...                ...   \n",
       "1338149                1        0             0                  0   \n",
       "1338150                1        0             0                  0   \n",
       "1338151                1        0             0                  0   \n",
       "1338152                1        0             0                  0   \n",
       "1338153                1        0             0                  0   \n",
       "\n",
       "                  keyword  \n",
       "0             animal park  \n",
       "1             animal park  \n",
       "2             animal park  \n",
       "3             animal park  \n",
       "4        botanical garden  \n",
       "...                   ...  \n",
       "1338149                    \n",
       "1338150                    \n",
       "1338151                    \n",
       "1338152                    \n",
       "1338153                    \n",
       "\n",
       "[1191246 rows x 37 columns]"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# create abbreviated df by combining keyword matches and missing ctee_cds\n",
    "df_abbr = pd.concat([df_keyword, df_not_na], ignore_index=True)  # add rows that contain this keyword\n",
    "df_abbr = df_abbr.drop_duplicates(\"ein\", keep='first')\n",
    "df_abbr"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "6d916f37",
   "metadata": {},
   "outputs": [],
   "source": [
    "# save frequencies to csv\n",
    "df_abbr.to_csv(\"4_Data_IRS_ExcludeMuseumOnly_abbr.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "3fc154df",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1191246, 37)"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_abbr.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bf413a1e",
   "metadata": {},
   "source": [
    "# Output 2: Count Keyword Frequencies"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f25c7e45",
   "metadata": {},
   "outputs": [],
   "source": [
    "matching_keywords =df_keyword_1[[\"keyword\", \"name\", \"ntee_cd\"]]\n",
    "    \n",
    "matching_keywords"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ec1de63d",
   "metadata": {},
   "outputs": [],
   "source": [
    "matching_keywords.to_csv(\"4_matching_keywords.csv\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "59c7c41d",
   "metadata": {},
   "source": [
    "### get frequencies based on keyword"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9b8d8c88",
   "metadata": {},
   "outputs": [],
   "source": [
    "freq_df = matching_keywords.groupby([\"keyword\", \"ntee_cd\"]).size().reset_index(name='count')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8a58fda1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# save frequencies to csv\n",
    "freq_df.to_csv(\"4_keyword_frequencies.csv\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e0e68532",
   "metadata": {},
   "source": [
    "# Output 3: Frequencies Based on ctee_cd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ec861426",
   "metadata": {},
   "outputs": [],
   "source": [
    "matching_keywords.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f49c8c1c",
   "metadata": {},
   "outputs": [],
   "source": [
    "# group by ctee_cd only\n",
    "freq_df_by_ctee = matching_keywords.groupby([\"ntee_cd\"]).size().reset_index(name='count').sort_values(\"count\", ascending = False)\n",
    "freq_df_by_ctee"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e6322bf6",
   "metadata": {},
   "outputs": [],
   "source": [
    "# save freqs by ctee_cd to csv\n",
    "freq_df_by_ctee.to_csv(\"4_ctee_frequencies.csv\", index = False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1e2091cd",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
